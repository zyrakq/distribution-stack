# Generated by stackbuilder from concatenated .env.example files
# Source files: base/.env.example, step-ca/.env.example, oidc/.env.example, imagelist-conf/.env.example, step-ca-trust/.env.example

# === BASE CONFIGURATION ===
# Project name for Docker Compose
COMPOSE_PROJECT_NAME=distribution

IMAGE=distribution/distribution:latest
# IMAGE=distribution/distribution:2.8.3
# IMAGE=localhost/distribution:2.8.3
CONFIG_DIR=/configs
CONFIG_FILE=/etc/distribution/config.yml

DISTRIBUTION_BASE_CONF_PATH=/configs/base-conf.yaml
REGISTRY_LOG_ACCESSLOG_DISABLED=false
REGISTRY_LOG_LEVEL=warn
REGISTRY_LOG_FORMATTER=json
REGISTRY_LOG_FIELDS_SERVICE=distribution
REGISTRY_LOG_FIELDS_ENVIRONMENT=production
REGISTRY_STORAGE_DELETE_ENABLED=true
REGISTRY_STORAGE_CACHE_BLOBDESCRIPTOR=inmemory
REGISTRY_STORAGE_MAINTENANCE_UPLOADPURGING_ENABLED=false
# === STEP CA CONFIGURATION ===
# Nginx proxy configuration
VIRTUAL_PORT=5000
VIRTUAL_HOST=distribution.local
VIRTUAL_PROTO=https

# Step CA SSL configuration
LETSENCRYPT_HOST=distribution.local
LETSENCRYPT_EMAIL=john.smith@mail.com

# Certificate configuration
REGISTRY_HTTP_TLS_CERTIFICATE=/certs/distribution.local.crt
REGISTRY_HTTP_TLS_KEY=/certs/distribution.local.key

DISTRIBUTION_VHOST_PATH=/vhost.d/distribution.local
# oidc
REGISTRY_AUTH_TOKEN_REALM=https://${OIDC_VIRTUAL_HOST}/api/v1/registry/auth
REGISTRY_AUTH_TOKEN_SERVICE=container_registry
REGISTRY_AUTH_TOKEN_ISSUER=registry_token_issuer
REGISTRY_AUTH_TOKEN_ROOTCERTBUNDLE=/oidc/certs/cert.crt
# REGISTRY_AUTH_TOKEN_ROOTCERTBUNDLE=/certs/${OIDC_VIRTUAL_HOST}.crt
DISTRIBUTION_CERTS=distribution-oidc-certs
# IMAGELIST-CONF
DISTRIBUTION_IMAGELIST_CONF_PATH=/configs/imagelist-conf.yaml

REGISTRY_NOTIFICATIONS_EVENTS_INCLUDEREFERENCES=true
REGISTRY_ENDPOINTS_IMAGELIST_NAME=ra-listener
REGISTRY_ENDPOINTS_IMAGELIST_DISABLED=false
REGISTRY_ENDPOINTS_IMAGELIST_URL=http://registry-admin/api/v1/registry/events
# 'admin:super-secret' base64 encode string
# echo -n "admin:super-secret" | base64
REGISTRY_NOTIFICATIONS_ENDPOINTS_IMAGELIST_HEADERS_AUTHORIZATION="Basic YWRTAW46C3VWZXITC2VJCMV0"
REGISTRY_ENDPOINTS_IMAGELIST_TIMEOUT=1s
REGISTRY_ENDPOINTS_IMAGELIST_THRESHOLD=5
REGISTRY_ENDPOINTS_IMAGELIST_BACKOFF=3s
REGISTRY_ENDPOINTS_IMAGELIST_IGNOREDMEDIATYPES=application/octet-stream
REGISTRY_ENDPOINTS_IMAGELIST_IGNORE_MEDIATYPES=application/octet-stream
#Step CA Trust
STEP_CA_TRUST=true
STEP_CA_TRUST_RESTART=true

# REQUESTS_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt
# SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt

# REQUESTS_CA_BUNDLE=/usr/local/share/ca-certificates/step-ca-bundle.crt
# SSL_CERT_FILE=/usr/local/share/ca-certificates/step-ca-bundle.crt